---
title: "CollegeScorecard Data Wrangling"
output: pdf_document
date: '2024-04-12'
---

```{r}
library(readr)
library(dplyr)
library(tidyverse)

setwd("/Users/ashwindev/Desktop/DataScience/project-02-rosa1/Processing/Wrangling")
```


```{r}
Most_Recent_Cohorts_Institution <- read_csv("Most-Recent-Cohorts-Institution.csv")
REED_TIDY <- read_csv("REED_TIDY.csv")
```

```{r}
head(Most_Recent_Cohorts_Institution)
tail(Most_Recent_Cohorts_Institution)
```


Important variables: 


ADM_RATE  
UGDS (Enrollment of undergraduate certificate/degree-seeking students)
UGDS_MEN
UGDS_WOMEN    
GRADS (# of graduate studnets)
CCSIZSET (Carnegie Classification -- size and setting)



UGDS_WHITE
UGDS_BLACK
UGDS_HISP
UGDS_ASIAN
UGDS_AIAN
UGDS_NHPI
UGDS_2MOR
UGDS_NRA
UGDS_UNKN
UGDS_WHITENH
UGDS_BLACKNH
UGDS_API
UGDS_AIANOLD
UGDS_HISPOLD
UG_NRA
UG_UNKN
UG_WHITENH
UG_BLACKNH
UG_API
UG_AIANOLD
UG_HISPOLD


TUITIONFEE_IN (in-state tuit)
TUITIONFEE_OUT (out of state tuit)
PCTPELL (% students receiving pell)
PCTFLOAN (% students receiving a student federal loan)
GRAD_DEBT_MDN (The median debt for students who have completed)
FAMINC (avg family income)
MD_FAMINC (median family income)

```{r}
college <- Most_Recent_Cohorts_Institution %>%
  select(
    ADM_RATE,
    UGDS,
    UGDS_MEN,
    UGDS_WOMEN,
    GRADS,
    CCSIZSET,
    UGDS_WHITE,
    UGDS_BLACK,
    UGDS_HISP,
    UGDS_ASIAN,
    UGDS_AIAN,
    UGDS_NHPI,
    UGDS_2MOR,
    UGDS_NRA,
    UGDS_UNKN,
    UGDS_WHITENH,
    UGDS_BLACKNH,
    UGDS_API,
    UGDS_AIANOLD,
    UGDS_HISPOLD,
    UG_NRA,
    UG_UNKN,
    UG_WHITENH,
    UG_BLACKNH,
    UG_API,
    UG_AIANOLD,
    UG_HISPOLD,
    TUITIONFEE_IN,
    TUITIONFEE_OUT,
    PCTPELL,
    PCTFLOAN,
    GRAD_DEBT_MDN,
    FAMINC,
    MD_FAMINC
  )
```

EDA

```{r}
college %>% 
  summarise(
    Average_Tuition_In = mean(TUITIONFEE_IN, na.rm = TRUE),
    Average_Tuition_Out = mean(TUITIONFEE_OUT, na.rm = TRUE),
    Median_Family_Income = median(MD_FAMINC, na.rm = TRUE),
    Average_Pct_Pell = mean(PCTPELL, na.rm = TRUE)
  )
```

```{r}
# Ensure TUITIONFEE_IN is numeric
college$TUITIONFEE_IN <- as.numeric(as.character(college$TUITIONFEE_IN))

# Histogram for In-State Tuition Fees
ggplot(college, aes(x = TUITIONFEE_IN)) +
  geom_histogram(bins = 30, fill = "blue", alpha = 0.7)

# Ensure MD_FAMINC is numeric
college$MD_FAMINC <- as.numeric(as.character(college$MD_FAMINC))

# Histogram for Median Family Income
ggplot(college, aes(x = MD_FAMINC)) +
  geom_histogram(bins = 30, fill = "green", alpha = 0.7) +
  labs(title = "Distribution of Median Family Income", x = "Median Family Income", y = "Frequency")
```


```{r}
library(dplyr)
library(ggplot2)

# Convert factors to numeric if necessary
college <- college %>%
  mutate(
    UGDS_MEN = as.numeric(as.character(UGDS_MEN)),
    UGDS_WOMEN = as.numeric(as.character(UGDS_WOMEN))
  )

# Handle missing values if necessary, for example, replacing NA with 0
# This step depends on the context and how you want to treat missing values
college <- college %>%
  mutate(
    UGDS_MEN = ifelse(is.na(UGDS_MEN), 0, UGDS_MEN),
    UGDS_WOMEN = ifelse(is.na(UGDS_WOMEN), 0, UGDS_WOMEN)
  )

# Create Total_UGDS column
college <- college %>%
  mutate(Total_UGDS = UGDS_MEN + UGDS_WOMEN)

# Create the plot
college %>%
  ggplot(aes(x = factor(1), y = UGDS_MEN / Total_UGDS, fill = "Men")) +
  geom_bar(stat = "identity") +
  geom_bar(aes(y = UGDS_WOMEN / Total_UGDS, fill = "Women"), stat = "identity") +
  scale_fill_manual(values = c("Men" = "blue", "Women" = "pink")) +
  labs(x = "", y = "Percentage", title = "Gender Distribution in Undergraduate Enrollment") +
  coord_polar(theta = "y")
```

```{r}
library(dplyr)

# Convert necessary columns to numeric
college <- college %>%
  mutate(
    TUITIONFEE_IN = as.numeric(as.character(TUITIONFEE_IN)),
    TUITIONFEE_OUT = as.numeric(as.character(TUITIONFEE_OUT)),
    MD_FAMINC = as.numeric(as.character(MD_FAMINC)),
    PCTPELL = as.numeric(as.character(PCTPELL)),
    PCTFLOAN = as.numeric(as.character(PCTFLOAN))
  )

# Selecting numeric variables
numeric_vars <- college %>% 
  select(TUITIONFEE_IN, TUITIONFEE_OUT, MD_FAMINC, PCTPELL, PCTFLOAN)

# Compute the correlation matrix with omitted NA values
correlation_matrix <- cor(na.omit(numeric_vars))
print(correlation_matrix)
```

SHINY APP:

```{r}
library(shiny)
library(shinydashboard)
library(ggplot2)
library(dplyr)
library(readr)

# Load the data
data <-read_csv("Most-Recent-Cohorts-Institution.csv") %>%
  mutate(
    TUITIONFEE_IN = as.numeric(as.character(TUITIONFEE_IN)),
    TUITIONFEE_OUT = as.numeric(as.character(TUITIONFEE_OUT)),
    INSTNM = as.character(INSTNM)  # Ensure institution names are character type
  )

# Calculate the average in-state and out-of-state tuition across all institutions
average_tuition <- data %>%
  summarise(
    Average_Tuition_In = mean(TUITIONFEE_IN, na.rm = TRUE),
    Average_Tuition_Out = mean(TUITIONFEE_OUT, na.rm = TRUE)
  )

# Define UI
ui <- dashboardPage(
  dashboardHeader(title = "Rosa 1.0"),
  dashboardSidebar(
    sidebarMenu(
      menuItem("Tuition Info", tabName = "tuition", icon = icon("dollar-sign")),
      menuItem("College Score", tabName = "score", icon = icon("building-columns"))
    )
  ),
  dashboardBody(
    tabItems(
      tabItem(tabName = "tuition",
        fluidRow(
          # Drop-down to select institution
          box(
            title = "Select Institution",
            selectInput(
              inputId = "institution",
              label = "Choose an Institution:",
              choices = unique(data$INSTNM),  
              selected = unique(data$INSTNM)[1]  # Default selection
            )
          )
        ),
        fluidRow(
         
          box(
            title = "Tuition Details",
            verbatimTextOutput("tuitionDetails")
          ),
         
          box(
            title = "Tuition Comparison",
            plotOutput("tuitionComparisonPlot")
          )
        )
      ),
      
      tabItem(tabName = "score",
              
              tags$style(HTML(".irs-value,.irs-single,.irs-max,.irs-min {opacity: 0;}.text-container {
    display: flex;
    justify-content: space-between;
    margin-top: 10px;
  }
  .irs-bar {background: #52BE80}
  ")),
  
  fluidRow(
         box(
            title = "How much do the following matter to you",collapsible = TRUE,collapsed=TRUE, width=6,
            sliderInput(
              inputId = "scaleCom",
              label = "Community",
              min=.5,
              max=1.5,
              value=1,
              ticks=FALSE,
              
               
            ),
            
            
      
      div(class = "text-container",
          p("Not Very"),
         
          p("Very")
      ),
      sliderInput(
              inputId = "scaleCor",
              label = "Courses",
              min=.5,
              max=1.5,
              value=1,
              ticks=FALSE,
              
               
            ),
            
            
      
      div(class = "text-container",
          p("Not Very"),
         
          p("Very")
      ),
      sliderInput(
              inputId = "scaleD",
              label = "Diversity",
              min=.5,
              max=1.5,
              value=1,
              ticks=FALSE,
              
               
            ),
            
            
      
      div(class = "text-container",
           p("Not Very"),
         
          p("Very")
      ),
      sliderInput(
              inputId = "scaleFin",
              label = "Financial",
              min=.5,
              max=1.5,
              value=1,
              ticks=FALSE,
              
                
            ),
            
            
      
      div(class = "text-container",
           p("Not Very"),
         
          p("Very")
      ),
      sliderInput(
              inputId = "scaleO",
              label = "Outcomes",
              min=.5,
              max=1.5,
              value=1,
              ticks=FALSE,
              
                
            ),
            
            
     
      div(class = "text-container",
          p("Not Very"),
         
          p("Very")
      ),
      sliderInput(
              inputId = "scaleP",
              label = "Professors",
              min=.5,
              max=1.5,
              value=1,
              ticks=FALSE,
              
              
            ),
            
            
     
      div(class = "text-container",
           p("Not Very"),
         
          p("Very")
      ),
      sliderInput(
              inputId = "scaleFd",
              label = "Food",
              min=.5,
              max=1.5,
              value=1,
              ticks=FALSE,
              
               
            )
         
      ),
       box(
            title = "Your College Score",
           p(strong("\nComposite Score:")),
            htmlOutput("totalscore"),
          p("\nCommunity Score:"),
            htmlOutput("comscore"),
           p("Courses Score:"),
            htmlOutput("corscore"),
           p("Diversity Score:\n"),
             htmlOutput("divscore"),
           p("Financial Score:\n"),
              htmlOutput("finscore"),
           p("Outcome Score:\n"),
               htmlOutput("outscore"),
           p("Professor Score:\n"),
            htmlOutput("profscore")
          ,
       p("Food Score:\n"),
            htmlOutput("fdscore")
          ))
    )
  )
  ))







server <- function(input, output) {
 
  output$tuitionDetails <- renderText({
    selected_institution <- input$institution
    
   
    tuition_info <- data %>%
      filter(INSTNM == selected_institution) %>%
      select(INSTNM, TUITIONFEE_IN, TUITIONFEE_OUT) %>%
      slice(1) 
    paste(
      "Institution: ", tuition_info$INSTNM, "\n",
      "In-State Tuition: $", tuition_info$TUITIONFEE_IN, "\n",
      "Out-of-State Tuition: $", tuition_info$TUITIONFEE_OUT
    )
  })
  
 
  output$tuitionComparisonPlot <- renderPlot({
    selected_institution <- input$institution
    
   
    tuition_info <- data %>%
      filter(INSTNM == selected_institution) %>%
      select(TUITIONFEE_IN, TUITIONFEE_OUT) %>%
      slice(1)
    
    
    tuition_df <- data.frame(
      TuitionType = c("Selected Institution - In-State", "Selected Institution - Out-of-State", 
                      "Average - In-State", "Average - Out-of-State"),
      TuitionValue = c(tuition_info$TUITIONFEE_IN, tuition_info$TUITIONFEE_OUT,
                       average_tuition$Average_Tuition_In, average_tuition$Average_Tuition_Out)
    )
    
    ggplot(tuition_df, aes(x = TuitionType, y = TuitionValue, fill = TuitionType)) +
      geom_bar(stat = "identity", alpha = 0.7) +
      labs(
        title = paste("Tuition Comparison for", selected_institution),
        x = "Tuition Type",
        y = "Tuition Fee ($)"
      ) +
      theme_minimal() +
      theme(axis.text.x = element_text(angle = 45, hjust = 1)) 
    
    
  })
  
  scoreGroup<- REED_TIDY%>%
      mutate(SentimentSC = ifelse(Sentiment=="Negative", -SentimentSC, SentimentSC))%>%
      group_by(Label)%>%
      summarize(score = mean(SentimentSC))
  
  format_value <- function(value) {
  if (value < 0) {
    value= -value
    paste("<span style='color: red;'>", value, "</span>", sep = "")
  } else {
    paste("<span style='color: green;'>", value, "</span>", sep = "")
  }
   
}
  
  totscr<- reactive({
   weightedAverage<- function(scores){
  
  weights <- c(input$scaleCom, input$scaleCor, input$scaleD, input$scaleFin,input$scaleFd, input$scaleO, input$scaleP)  
  
  
  weighted_sum <- sum(scores * weights)

  average <- round(weighted_sum / 7, digits = 2)
  return(average*100)
   }
   
   scoreComp<-weightedAverage(scoreGroup$score)
   

    
   
    comp<-format_value(scoreComp)
    comp
  })
  
  divscr<- reactive({
   
   indvScoreFix <- function(x){
     return(round(x/5,digits=2)*100)
   }
    
   
    div<-format_value(indvScoreFix(scoreGroup$score[3]))
    div
  })
  
  finscr<- reactive({
    
   indvScoreFix <- function(x){
     return(round(x/5,digits=2)*100)
   }
    
    
    fin<-format_value(indvScoreFix(scoreGroup$score[4]))
    fin
  })
  
  fdscr<- reactive({
    
   indvScoreFix <- function(x){
     return(round(x/5,digits=2)*100)
   }
    
    
    fd<-format_value(indvScoreFix(scoreGroup$score[5]))
    fd
  })
  
  corscr<- reactive({
    
   indvScoreFix <- function(x){
     return(round(x/5,digits=2)*100)
   }
    
    
    cor<-format_value(indvScoreFix(scoreGroup$score[2]))
    cor
  })
  
  comscr<- reactive({
    
   indvScoreFix <- function(x){
     return(round(x/5,digits=2)*100)
   }
    
   
   com<-format_value(indvScoreFix(scoreGroup$score[1]))
   com
    
  })
  
  outscr<- reactive({
    
   indvScoreFix <- function(x){
     return(round(x/5,digits=2)*100)
   }
    
   
   out<-format_value(indvScoreFix(scoreGroup$score[6]))
   out
    
  })
  
  profscr<- reactive({
    
   indvScoreFix <- function(x){
     return(round(x/5,digits=2)*100)
   }
    
   
    
      prf<- format_value(indvScoreFix(scoreGroup$score[7]))
      prf
    
  })
  
  
   
   output$totalscore <- renderText({
    totscr()
  })
    output$divscore <- renderText({
    divscr()
  })
     output$finscore <- renderText({
    finscr()
  })
      output$fdscore <- renderText({
    fdscr()
  })
       output$corscore <- renderText({
    corscr()
  })
        output$comscore <- renderText({
    comscr()
  })
         output$outscore <- renderText({
    outscr()
  })
          output$profscore <- renderText({
    profscr()
  })
   
  
   
   
   
   
}


shinyApp(ui = ui, server = server)
```


